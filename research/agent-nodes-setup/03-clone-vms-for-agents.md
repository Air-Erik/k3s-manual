# –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ VM –¥–ª—è k3s Agent –Ω–æ–¥

> **–≠—Ç–∞–ø:** 1.2.3 - VM Cloning for Agent Nodes
> **–î–∞—Ç–∞:** 2025-10-24
> **–°—Ç–∞—Ç—É—Å:** üñ•Ô∏è –°–æ–∑–¥–∞–Ω–∏–µ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã

---

## üìã –û–±–∑–æ—Ä

–ù–∞ —ç—Ç–æ–º —ç—Ç–∞–ø–µ —Å–æ–∑–¥–∞—ë–º **2 –≤–∏—Ä—Ç—É–∞–ª—å–Ω—ã–µ –º–∞—à–∏–Ω—ã** –¥–ª—è k3s Agent –Ω–æ–¥ –ø—É—Ç—ë–º –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –∏–∑ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω–Ω–æ–≥–æ Template.

### –ß—Ç–æ –±—É–¥–µ–º –¥–µ–ª–∞—Ç—å:
1. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å Agent Node 1** (k3s-agent-01) —Å IP 10.246.10.51
2. **–ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å Agent Node 2** (k3s-agent-02) —Å IP 10.246.10.52
3. **–ü—Ä–∏–º–µ–Ω–∏—Ç—å cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏** –¥–ª—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–π –Ω–∞—Å—Ç—Ä–æ–π–∫–∏
4. **–ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –Ω–æ–¥** –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ k3s

### –†–µ–∑—É–ª—å—Ç–∞—Ç:
- 2 –≥–æ—Ç–æ–≤—ã–µ VM —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ IP –∞–¥—Ä–µ—Å–∞–º–∏ –∏ hostname
- SSH –¥–æ—Å—Ç—É–ø –∫ –æ–±–µ–∏–º –Ω–æ–¥–∞–º
- –°–µ—Ç–µ–≤–æ–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Server –Ω–æ–¥–µ (10.246.10.50)

---

## üìä –°–ø–µ—Ü–∏—Ñ–∏–∫–∞—Ü–∏—è Agent –Ω–æ–¥

### –û–±—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –¥–ª—è –æ–±–µ–∏—Ö Agent –Ω–æ–¥:

```yaml
Template Source: k3s-ubuntu2404-minimal-template
OS: Ubuntu 24.04 LTS (minimal)
vCPU: 2 cores
RAM: 2 GB
Disk: 40 GB
Network: k8s-zeon-dev-segment (NSX-T)
```

### –°–ø–µ—Ü–∏—Ñ–∏—á–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

| –ü–∞—Ä–∞–º–µ—Ç—Ä | Agent Node 1 | Agent Node 2 |
|----------|--------------|--------------|
| **VM Name** | `k3s-agent-01` | `k3s-agent-02` |
| **Hostname** | `k3s-agent-01` | `k3s-agent-02` |
| **IP Address** | `10.246.10.51/24` | `10.246.10.52/24` |
| **Gateway** | `10.246.10.1` | `10.246.10.1` |
| **DNS** | `172.17.10.3, 8.8.8.8` | `172.17.10.3, 8.8.8.8` |
| **Cloud-init userdata** | `agent-node-01-userdata.yaml` | `agent-node-02-userdata.yaml` |
| **Cloud-init metadata** | `agent-node-01-metadata.yaml` | `agent-node-02-metadata.yaml` |

---

## üóÇÔ∏è Cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

### –†–∞—Å–ø–æ–ª–æ–∂–µ–Ω–∏–µ —Ñ–∞–π–ª–æ–≤:

```
manifests/cloud-init/
‚îú‚îÄ‚îÄ agent-node-01-userdata.yaml    # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Agent-01
‚îú‚îÄ‚îÄ agent-node-01-metadata.yaml    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–µ—Ç–∏ Agent-01
‚îú‚îÄ‚îÄ agent-node-02-userdata.yaml    # –û—Å–Ω–æ–≤–Ω–∞—è –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è Agent-02
‚îú‚îÄ‚îÄ agent-node-02-metadata.yaml    # –ú–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ —Å–µ—Ç–∏ Agent-02
‚îî‚îÄ‚îÄ README.md                       # –ò–Ω—Å—Ç—Ä—É–∫—Ü–∏–∏ –ø–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—é
```

### –ß—Ç–æ –Ω–∞—Å—Ç—Ä–∞–∏–≤–∞–µ—Ç—Å—è —á–µ—Ä–µ–∑ cloud-init:

```yaml
–í userdata.yaml:
  ‚úÖ Hostname (k3s-agent-01/02)
  ‚úÖ SSH –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å k8s-admin
  ‚úÖ SSH –∫–ª—é—á–∏ –∏ –ø–∞—Ä–æ–ª–∏
  ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–∫–∞ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã—Ö –ø–∞–∫–µ—Ç–æ–≤
  ‚úÖ Timezone –∏ –ª–æ–∫–∞–ª—å
  ‚úÖ –°–∏—Å—Ç–µ–º–Ω—ã–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏

–í metadata.yaml:
  ‚úÖ –°—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π IP –∞–¥—Ä–µ—Å
  ‚úÖ –°–µ—Ç–µ–≤–∞—è –º–∞—Å–∫–∞ /24
  ‚úÖ Gateway 10.246.10.1
  ‚úÖ DNS —Å–µ—Ä–≤–µ—Ä—ã
  ‚úÖ –ò–º—è —Å–µ—Ç–µ–≤–æ–≥–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å–∞
```

**–ü—Ä–∏–º–µ—á–∞–Ω–∏–µ:** Cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏ —É–∂–µ –ø–æ–¥–≥–æ—Ç–æ–≤–ª–µ–Ω—ã –≤ –ø—Ä–æ–µ–∫—Ç–µ! –ò—Å–ø–æ–ª—å–∑—É–π—Ç–µ –≥–æ—Ç–æ–≤—ã–µ —Ñ–∞–π–ª—ã.

---

## üîß –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Agent Node 1 (k3s-agent-01)

### –®–∞–≥ 1: –ó–∞–ø—É—Å–∫ –º–∞—Å—Ç–µ—Ä–∞ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –≤ vSphere

```
1. –û—Ç–∫—Ä—ã—Ç—å vSphere Client
2. –ù–∞–≤–∏–≥–∞—Ü–∏—è: Datacenter ‚Üí VMs and Templates
3. –ù–∞–π—Ç–∏: k3s-ubuntu2404-minimal-template
4. –ü–ö–ú ‚Üí Clone ‚Üí Clone to Virtual Machine...
```

### –®–∞–≥ 2: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –æ—Å–Ω–æ–≤–Ω—ã—Ö –ø–∞—Ä–∞–º–µ—Ç—Ä–æ–≤

**Select name and folder:**
```
VM Name: k3s-agent-01
Folder: [–í–∞—à–∞ –ø–∞–ø–∫–∞ –¥–ª—è k3s VMs]
```

**Select compute resource:**
```
–í—ã–±—Ä–∞—Ç—å: [–¶–µ–ª–µ–≤–æ–π ESXi host –∏–ª–∏ Cluster]
–°–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å: ESXi 8.0 and later
```

**Select storage:**
```
Storage Policy: [–ü–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–ª–∏ –≤–∞—à policy]
Datastore: [–í—ã–±—Ä–∞—Ç—å –ø–æ–¥—Ö–æ–¥—è—â–∏–π datastore]
```

### –®–∞–≥ 3: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**Select clone options:**
```
‚òëÔ∏è Customize the guest OS
‚òëÔ∏è Power on virtual machine after creation
```

### –®–∞–≥ 4: –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Hardware (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)

**–ï—Å–ª–∏ –Ω—É–∂–Ω–æ –∏–∑–º–µ–Ω–∏—Ç—å —Ö–∞—Ä–∞–∫—Ç–µ—Ä–∏—Å—Ç–∏–∫–∏:**
```
CPU: 2 vCPU (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ Template)
Memory: 2048 MB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ Template)
Hard Disk: 40 GB (–ø–æ —É–º–æ–ª—á–∞–Ω–∏—é –∏–∑ Template)
Network: k8s-zeon-dev-segment (–ø—Ä–æ–≤–µ—Ä–∏—Ç—å!)
```

### –®–∞–≥ 5: –ü—Ä–∏–º–µ–Ω–µ–Ω–∏–µ cloud-init –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏–∏

**VM Options ‚Üí Advanced ‚Üí Configuration Parameters:**

–î–æ–±–∞–≤–∏—Ç—å —Å–ª–µ–¥—É—é—â–∏–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã:

```
Key: guestinfo.userdata
Value: [—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ manifests/cloud-init/agent-node-01-userdata.yaml]

Key: guestinfo.userdata.encoding
Value: base64

Key: guestinfo.metadata
Value: [—Å–æ–¥–µ—Ä–∂–∏–º–æ–µ manifests/cloud-init/agent-node-01-metadata.yaml]

Key: guestinfo.metadata.encoding
Value: base64
```

**–ö–∞–∫ –ø–æ–ª—É—á–∏—Ç—å base64 —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ:**
```bash
# –ù–∞ –ª–æ–∫–∞–ª—å–Ω–æ–π –º–∞—à–∏–Ω–µ
base64 -w 0 manifests/cloud-init/agent-node-01-userdata.yaml > userdata.b64
base64 -w 0 manifests/cloud-init/agent-node-01-metadata.yaml > metadata.b64

# –°–∫–æ–ø–∏—Ä–æ–≤–∞—Ç—å —Å–æ–¥–µ—Ä–∂–∏–º–æ–µ —Ñ–∞–π–ª–æ–≤ .b64 –≤ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É—é—â–∏–µ –ø–æ–ª—è
```

### –®–∞–≥ 6: –ó–∞–≤–µ—Ä—à–µ–Ω–∏–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

```
1. –ù–∞–∂–∞—Ç—å "Finish"
2. –î–æ–∂–¥–∞—Ç—å—Å—è –∑–∞–≤–µ—Ä—à–µ–Ω–∏—è –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è (~2-3 –º–∏–Ω—É—Ç—ã)
3. VM –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∑–∞–ø—É—Å—Ç–∏—Ç—Å—è (–µ—Å–ª–∏ –≤—ã–±—Ä–∞–Ω Power On)
4. Cloud-init –ø—Ä–∏–º–µ–Ω–∏—Ç –∫–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—é (~2-3 –º–∏–Ω—É—Ç—ã)
```

### –®–∞–≥ 7: –ü–µ—Ä–≤–∞—è –ø—Ä–æ–≤–µ—Ä–∫–∞ Agent Node 1

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ VM –∑–∞–ø—É—â–µ–Ω–∞ –≤ vSphere
# Status: Powered On

# –ü–æ–ø—Ä–æ–±–æ–≤–∞—Ç—å SSH —á–µ—Ä–µ–∑ 3-4 –º–∏–Ω—É—Ç—ã –ø–æ—Å–ª–µ –∑–∞–ø—É—Å–∫–∞
ssh k8s-admin@10.246.10.51

# –ü—Ä–∏ —É—Å–ø–µ—à–Ω–æ–º –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –ø—Ä–æ–≤–µ—Ä–∏—Ç—å:
hostname
# –û–∂–∏–¥–∞–µ—Ç—Å—è: k3s-agent-01

ip addr show ens192
# –û–∂–∏–¥–∞–µ—Ç—Å—è: inet 10.246.10.51/24

ping 10.246.10.1
# –û–∂–∏–¥–∞–µ—Ç—Å—è: gateway –¥–æ—Å—Ç—É–ø–µ–Ω

ping 10.246.10.50
# –û–∂–∏–¥–∞–µ—Ç—Å—è: Server –Ω–æ–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞

exit
```

---

## üîß –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ Agent Node 2 (k3s-agent-02)

### –ü—Ä–æ—Ü–µ—Å—Å –∞–Ω–∞–ª–æ–≥–∏—á–Ω—ã–π Agent Node 1

**–û—Ç–ª–∏—á–∏—è –¥–ª—è Agent Node 2:**

```
VM Name: k3s-agent-02
Cloud-init userdata: agent-node-02-userdata.yaml
Cloud-init metadata: agent-node-02-metadata.yaml
–û–∂–∏–¥–∞–µ–º—ã–π IP: 10.246.10.52
–û–∂–∏–¥–∞–µ–º—ã–π hostname: k3s-agent-02
```

### –ë—ã—Å—Ç—Ä–∞—è –∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è:

```bash
1. –ü–ö–ú –Ω–∞ Template ‚Üí Clone ‚Üí Clone to Virtual Machine
2. Name: k3s-agent-02
3. Select compute/storage resources
4. ‚òëÔ∏è Customize guest OS + ‚òëÔ∏è Power on
5. VM Options ‚Üí Configuration Parameters:
   - guestinfo.userdata = base64(agent-node-02-userdata.yaml)
   - guestinfo.metadata = base64(agent-node-02-metadata.yaml)
6. Finish
7. –ñ–¥–∞—Ç—å 5-6 –º–∏–Ω—É—Ç
8. SSH test: ssh k8s-admin@10.246.10.52
```

### –ü—Ä–æ–≤–µ—Ä–∫–∞ Agent Node 2:

```bash
ssh k8s-admin@10.246.10.52

# –ü—Ä–æ–≤–µ—Ä–∫–∏
hostname          # ‚Üí k3s-agent-02
ip addr show ens192  # ‚Üí 10.246.10.52/24
ping 10.246.10.1     # ‚Üí gateway OK
ping 10.246.10.50    # ‚Üí server OK

exit
```

---

## ‚úÖ –ü—Ä–æ–≤–µ—Ä–∫–∞ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ –æ–±–µ–∏—Ö Agent –Ω–æ–¥

### –°–µ—Ç–µ–≤–∞—è —Å–≤—è–∑–Ω–æ—Å—Ç—å

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å –æ–±–µ–∏—Ö Agent –Ω–æ–¥
ping 10.246.10.51    # Agent-01
ping 10.246.10.52    # Agent-02

# SSH –¥–æ—Å—Ç—É–ø –∫ –æ–±–µ–∏–º –Ω–æ–¥–∞–º
ssh k8s-admin@10.246.10.51 "hostname && ip addr show ens192 | grep inet"
ssh k8s-admin@10.246.10.52 "hostname && ip addr show ens192 | grep inet"

# –û–∂–∏–¥–∞–µ–º—ã–π –≤—ã–≤–æ–¥:
# k3s-agent-01
# inet 10.246.10.51/24 brd 10.246.10.255 scope global ens192
#
# k3s-agent-02
# inet 10.246.10.52/24 brd 10.246.10.255 scope global ens192
```

### –ü–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –∫ Server –Ω–æ–¥–µ

```bash
# –° –∫–∞–∂–¥–æ–π Agent –Ω–æ–¥—ã –ø—Ä–æ–≤–µ—Ä–∏—Ç—å –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç—å Server
ssh k8s-admin@10.246.10.51 "curl -k -s --connect-timeout 5 https://10.246.10.50:6443/version | head -3"
ssh k8s-admin@10.246.10.52 "curl -k -s --connect-timeout 5 https://10.246.10.50:6443/version | head -3"

# –û–∂–∏–¥–∞–µ—Ç—Å—è JSON –æ—Ç–≤–µ—Ç —Å –≤–µ—Ä—Å–∏–µ–π k3s
# {
#   "major": "1",
#   "minor": "30+",
```

### –°–∏—Å—Ç–µ–º–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —Ä–µ—Å—É—Ä—Å—ã –Ω–∞ Agent –Ω–æ–¥–∞—Ö
ssh k8s-admin@10.246.10.51 "free -h && df -h /"
ssh k8s-admin@10.246.10.52 "free -h && df -h /"

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# RAM: ~2GB total
# Disk: ~40GB total, >85% free
```

### –ü–∞–∫–µ—Ç—ã –∏ –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç—å –∫ k3s

```bash
# –ü—Ä–æ–≤–µ—Ä–∏—Ç—å —á—Ç–æ –Ω–µ–æ–±—Ö–æ–¥–∏–º—ã–µ –ø–∞–∫–µ—Ç—ã —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
ssh k8s-admin@10.246.10.51 "which curl && which systemctl && systemctl is-system-running"
ssh k8s-admin@10.246.10.52 "which curl && which systemctl && systemctl is-system-running"

# –û–∂–∏–¥–∞–µ—Ç—Å—è:
# /usr/bin/curl
# /usr/bin/systemctl
# running (–∏–ª–∏ degraded - —ç—Ç–æ –Ω–æ—Ä–º–∞–ª—å–Ω–æ)
```

---

## üö® Troubleshooting –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

### –ü—Ä–æ–±–ª–µ–º–∞ 1: VM –Ω–µ –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –ø–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- VM –≤ —Å–æ—Å—Ç–æ—è–Ω–∏–∏ "Powered Off"
- –ò–ª–∏ –∑–∞–≤–∏—Å–∞–µ—Ç –Ω–∞ boot screen

**–†–µ—à–µ–Ω–∏–µ:**
```bash
1. –í vSphere: VM ‚Üí Actions ‚Üí Edit Settings
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å:
   - Hardware Compatibility = ESXi 8.0+
   - Boot Options ‚Üí Firmware = BIOS (–Ω–µ UEFI)
   - Network Adapter –ø–æ–¥–∫–ª—é—á—ë–Ω –∫ –ø—Ä–∞–≤–∏–ª—å–Ω–æ–º—É —Å–µ–≥–º–µ–Ω—Ç—É
3. Power On –∑–∞–Ω–æ–≤–æ
```

### –ü—Ä–æ–±–ª–µ–º–∞ 2: Cloud-init –Ω–µ –ø—Ä–∏–º–µ–Ω—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
- VM –∑–∞–ø—É—Å–∫–∞–µ—Ç—Å—è –Ω–æ hostname –Ω–µ –∏–∑–º–µ–Ω–∏–ª—Å—è
- IP –æ—Å—Ç–∞–ª—Å—è –∫–∞–∫ –≤ Template (DHCP)
- SSH –Ω–µ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–∞ –Ω–æ–≤–æ–º IP

**–†–µ—à–µ–Ω–∏–µ:**
```bash
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å guestinfo –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –≤ VM settings
2. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ userdata/metadata –≤ base64
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –ª–æ–≥–∏ cloud-init –Ω–∞ VM:
   ssh [old-ip] "sudo cloud-init status"
   ssh [old-ip] "sudo journalctl -u cloud-init"
4. –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VM —Å –ø—Ä–∞–≤–∏–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
```

### –ü—Ä–æ–±–ª–µ–º–∞ 3: –ù–µ–ø—Ä–∞–≤–∏–ª—å–Ω—ã–π IP –∞–¥—Ä–µ—Å

**–°–∏–º–ø—Ç–æ–º—ã:**
- VM –ø–æ–ª—É—á–∞–µ—Ç IP —á–µ—Ä–µ–∑ DHCP –≤–º–µ—Å—Ç–æ —Å—Ç–∞—Ç–∏—á–µ—Å–∫–æ–≥–æ
- IP –Ω–µ —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤—É–µ—Ç –æ–∂–∏–¥–∞–µ–º–æ–º—É (.51 –∏–ª–∏ .52)

**–†–µ—à–µ–Ω–∏–µ:**
```bash
1. SSH –∫ VM –ø–æ DHCP IP (–Ω–∞–π—Ç–∏ –≤ vSphere console)
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å cloud-init metadata:
   sudo cat /var/lib/cloud/instance/cloud-config.txt
3. –ï—Å–ª–∏ metadata –Ω–µ–ø—Ä–∞–≤–∏–ª—å–Ω–∞—è - –ø–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å VM
4. –ï—Å–ª–∏ –ø—Ä–∞–≤–∏–ª—å–Ω–∞—è - –ø—Ä–∏–º–µ–Ω–∏—Ç—å –≤—Ä—É—á–Ω—É—é:
   sudo netplan apply
```

### –ü—Ä–æ–±–ª–µ–º–∞ 4: SSH –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–µ –æ—Ç–∫–ª–æ–Ω—è–µ—Ç—Å—è

**–°–∏–º–ø—Ç–æ–º—ã:**
```bash
ssh k8s-admin@10.246.10.51
# ssh: connect to host 10.246.10.51 port 22: Connection refused
```

**–†–µ—à–µ–Ω–∏–µ:**
```bash
1. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å VM –¥–æ—Å—Ç—É–ø–µ–Ω:
   ping 10.246.10.51

2. –ü–æ–¥–∫–ª—é—á–∏—Ç—å—Å—è —á–µ—Ä–µ–∑ vSphere console
3. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å SSH service:
   sudo systemctl status ssh
   sudo systemctl start ssh

4. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å firewall:
   sudo ufw status
   sudo ufw allow ssh
```

### –ü—Ä–æ–±–ª–µ–º–∞ 5: Template –Ω–µ –Ω–∞–π–¥–µ–Ω

**–°–∏–º–ø—Ç–æ–º—ã:**
- Template `k3s-ubuntu2404-minimal-template` –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç –≤ vSphere

**–†–µ—à–µ–Ω–∏–µ:**
```bash
1. –£–±–µ–¥–∏—Ç—å—Å—è —á—Ç–æ –≠—Ç–∞–ø 0 (VM Template preparation) –≤—ã–ø–æ–ª–Ω–µ–Ω
2. –ü—Ä–æ–≤–µ—Ä–∏—Ç—å –≤ –¥—Ä—É–≥–æ–π –ø–∞–ø–∫–µ vSphere
3. –ï—Å–ª–∏ Template –æ—Ç—Å—É—Ç—Å—Ç–≤—É–µ—Ç - –≤—ã–ø–æ–ª–Ω–∏—Ç—å –ø–æ–¥–≥–æ—Ç–æ–≤–∫—É Template —Å–Ω–∞—á–∞–ª–∞
4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–π Ubuntu 24.04 template –µ—Å–ª–∏ –µ—Å—Ç—å
```

---

## üìã –ß–µ–∫-–ª–∏—Å—Ç –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ Agent –Ω–æ–¥

–ü–æ—Å–ª–µ –∫–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏—è –æ–±–µ Agent –Ω–æ–¥—ã –¥–æ–ª–∂–Ω—ã —Å–æ–æ—Ç–≤–µ—Ç—Å—Ç–≤–æ–≤–∞—Ç—å:

### Agent Node 1 (k3s-agent-01):
- [ ] VM —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø—É—â–µ–Ω–∞ –≤ vSphere
- [ ] Hostname = k3s-agent-01
- [ ] IP –∞–¥—Ä–µ—Å = 10.246.10.51/24
- [ ] SSH –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç: `ssh k8s-admin@10.246.10.51`
- [ ] Gateway –¥–æ—Å—Ç—É–ø–µ–Ω: `ping 10.246.10.1`
- [ ] Server –Ω–æ–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞: `ping 10.246.10.50`
- [ ] k3s API –¥–æ—Å—Ç—É–ø–µ–Ω: `curl -k https://10.246.10.50:6443/version`

### Agent Node 2 (k3s-agent-02):
- [ ] VM —Å–æ–∑–¥–∞–Ω–∞ –∏ –∑–∞–ø—É—â–µ–Ω–∞ –≤ vSphere
- [ ] Hostname = k3s-agent-02
- [ ] IP –∞–¥—Ä–µ—Å = 10.246.10.52/24
- [ ] SSH –¥–æ—Å—Ç—É–ø —Ä–∞–±–æ—Ç–∞–µ—Ç: `ssh k8s-admin@10.246.10.52`
- [ ] Gateway –¥–æ—Å—Ç—É–ø–µ–Ω: `ping 10.246.10.1`
- [ ] Server –Ω–æ–¥–∞ –¥–æ—Å—Ç—É–ø–Ω–∞: `ping 10.246.10.50`
- [ ] k3s API –¥–æ—Å—Ç—É–ø–µ–Ω: `curl -k https://10.246.10.50:6443/version`

### –û–±—â–∏–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:
- [ ] –û–±–µ –Ω–æ–¥—ã –≤–∏–¥—è—Ç –¥—Ä—É–≥ –¥—Ä—É–≥–∞: –≤–∑–∞–∏–º–Ω—ã–π ping –º–µ–∂–¥—É .51 –∏ .52
- [ ] –ù–∞ –æ–±–µ–∏—Ö –Ω–æ–¥–∞—Ö —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã curl, systemctl, –±–∞–∑–æ–≤—ã–µ –ø–∞–∫–µ—Ç—ã
- [ ] –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ —Å–≤–æ–±–æ–¥–Ω–æ–≥–æ –º–µ—Å—Ç–∞: >30GB –Ω–∞ –¥–∏—Å–∫–µ
- [ ] –î–æ—Å—Ç–∞—Ç–æ—á–Ω–æ RAM: ~2GB –¥–æ—Å—Ç—É–ø–Ω–æ–π –ø–∞–º—è—Ç–∏
- [ ] –ò–Ω—Ç–µ—Ä–Ω–µ—Ç –¥–æ—Å—Ç—É–ø–µ–Ω: `ping 8.8.8.8`

---

## üìä –í—Ä–µ–º—è –≤—ã–ø–æ–ª–Ω–µ–Ω–∏—è

| –û–ø–µ—Ä–∞—Ü–∏—è | Agent Node 1 | Agent Node 2 | –ò—Ç–æ–≥–æ |
|----------|--------------|--------------|-------|
| –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ cloud-init | 2 –º–∏–Ω | 1 –º–∏–Ω | 3 –º–∏–Ω |
| –ö–ª–æ–Ω–∏—Ä–æ–≤–∞–Ω–∏–µ VM | 3 –º–∏–Ω | 3 –º–∏–Ω | 6 –º–∏–Ω |
| Boot + cloud-init | 4 –º–∏–Ω | 4 –º–∏–Ω | 8 –º–∏–Ω |
| –í–∞–ª–∏–¥–∞—Ü–∏—è –≥–æ—Ç–æ–≤–Ω–æ—Å—Ç–∏ | 2 –º–∏–Ω | 1 –º–∏–Ω | 3 –º–∏–Ω |
| **–ò–¢–û–ì–û** | **11 –º–∏–Ω** | **9 –º–∏–Ω** | **~20 –º–∏–Ω** |

---

## ‚û°Ô∏è –°–ª–µ–¥—É—é—â–∏–π —à–∞–≥

**‚úÖ VM –¥–ª—è Agent –Ω–æ–¥ –≥–æ—Ç–æ–≤—ã!**

**–ò–º–µ–µ–º:**
- k3s-server-01 (10.246.10.50) ‚Äî —Ä–∞–±–æ—Ç–∞–µ—Ç ‚úÖ
- k3s-agent-01 (10.246.10.51) ‚Äî –≥–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ k3s ‚úÖ
- k3s-agent-02 (10.246.10.52) ‚Äî –≥–æ—Ç–æ–≤ –∫ —É—Å—Ç–∞–Ω–æ–≤–∫–µ k3s ‚úÖ
- Node-token –ø–æ–ª—É—á–µ–Ω ‚úÖ

**–î–∞–ª–µ–µ:** [04-installation-steps.md](./04-installation-steps.md) ‚Äî —É—Å—Ç–∞–Ω–æ–≤–∫–∞ k3s agent –Ω–∞ –æ–±–µ–∏—Ö –Ω–æ–¥–∞—Ö

---

**–ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –≥–æ—Ç–æ–≤–∞! –¢–µ–ø–µ—Ä—å –ø—Ä–∏—Å–æ–µ–¥–∏–Ω—è–µ–º Agent –Ω–æ–¥—ã –∫ –∫–ª–∞—Å—Ç–µ—Ä—É! üöÄ**
