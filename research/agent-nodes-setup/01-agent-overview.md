# ะะฑะทะพั k3s Agent Nodes ะธ ะฟัะพัะตััะฐ ะฟัะธัะพะตะดะธะฝะตะฝะธั

> **ะญัะฐะฟ:** 1.2.1 - Agent Nodes Overview
> **ะะฐัะฐ:** 2025-10-24
> **ะกัะฐััั:** ๐ ะขะตะพัะตัะธัะตัะบะฐั ะฑะฐะทะฐ

---

## ๐ ะงัะพ ัะฐะบะพะต k3s Agent Node?

**k3s Agent Node** โ ััะพ ัะฐะฑะพัะฐั ะฝะพะดะฐ ะฒ ะบะปะฐััะตัะต k3s, ะบะพัะพัะฐั ะฒัะฟะพะปะฝัะตั ัะพะปัะบะพ ะทะฐะดะฐัะธ ะฟะพ ะทะฐะฟััะบั ะบะพะฝัะตะนะฝะตัะพะฒ ะธ ะะ ัะพะดะตัะถะธั ะบะพะผะฟะพะฝะตะฝัั ัะฟัะฐะฒะปะตะฝะธั ะบะปะฐััะตัะพะผ.

### ะัะฝะพะฒะฝัะต ััะฝะบัะธะธ Agent ะฝะพะดั:

```yaml
Agent Node ะฒะบะปััะฐะตั:
  โ kubelet          # ะฃะฟัะฐะฒะปะตะฝะธะต pods ะฝะฐ ะฝะพะดะต
  โ kube-proxy       # ะกะตัะตะฒะฐั ะผะฐัััััะธะทะฐัะธั services
  โ containerd       # Container runtime (ะฒัััะพะตะฝ ะฒ k3s)
  โ Flannel CNI      # Pod networking (ะฒัััะพะตะฝ)

Agent Node ะะ ะฒะบะปััะฐะตั:
  โ API Server       # ะขะพะปัะบะพ ะฝะฐ Server ะฝะพะดะฐั
  โ etcd            # ะขะพะปัะบะพ ะฝะฐ Server ะฝะพะดะฐั
  โ Controller      # ะขะพะปัะบะพ ะฝะฐ Server ะฝะพะดะฐั
  โ Scheduler       # ะขะพะปัะบะพ ะฝะฐ Server ะฝะพะดะฐั
```

**ะัะพัััะผะธ ัะปะพะฒะฐะผะธ:** Agent ะฝะพะดะฐ = "ัะฐะฑะพัะฐั ะปะพัะฐะดะบะฐ" ะดะปั ะทะฐะฟััะบะฐ ะฟัะธะปะพะถะตะฝะธะน, ะฟะพะปััะฐะตั ะบะพะผะฐะฝะดั ะพั Server ะฝะพะดั.

---

## ๐๏ธ ะััะธัะตะบัััะฐ: Server vs Agent

### ะกัะฐะฒะฝะตะฝะธะต ะบะพะผะฟะพะฝะตะฝัะพะฒ:

| ะะพะผะฟะพะฝะตะฝั | Server Node | Agent Node | ะะฐะทะฝะฐัะตะฝะธะต |
|-----------|-------------|------------|------------|
| **API Server** | โ | โ | Kubernetes API endpoint |
| **etcd** | โ | โ | ะะฐะทะฐ ะดะฐะฝะฝัั ะบะปะฐััะตัะฐ |
| **Controller Manager** | โ | โ | ะฃะฟัะฐะฒะปะตะฝะธะต ัะตััััะฐะผะธ |
| **Scheduler** | โ | โ | ะะฐะทะผะตัะตะฝะธะต pods |
| **kubelet** | โ | โ | ะฃะฟัะฐะฒะปะตะฝะธะต pods ะฝะฐ ะฝะพะดะต |
| **kube-proxy** | โ | โ | Service networking |
| **containerd** | โ | โ | Container runtime |
| **Flannel** | โ | โ | Pod networking (CNI) |

### ะะธะทัะฐะปัะฝะฐั ััะตะผะฐ ะฝะฐัะตะณะพ ะบะปะฐััะตัะฐ:

```
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
โ                 k3s Cluster Architecture                    โ
โโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโโ
                              โ
                    โโโโโโโโโโโผโโโโโโโโโโ
                    โ   k3s-server-01   โ
                    โ   10.246.10.50    โ
                    โ                   โ
                    โ  โโโโโโโโโโโโโโโ  โ
                    โ  โ API Server  โ  โ โโโ kubectl ะฟะพะดะบะปััะฐะตััั ััะดะฐ
                    โ  โ etcd        โ  โ
                    โ  โ Controller  โ  โ
                    โ  โ Scheduler   โ  โ
                    โ  โโโโโโโโโโโโโโโ  โ
                    โ  โโโโโโโโโโโโโโโ  โ
                    โ  โ kubelet     โ  โ โโโ ะะพะถะตั ะทะฐะฟััะบะฐัั workloads
                    โ  โ kube-proxy  โ  โ
                    โ  โ containerd  โ  โ
                    โ  โโโโโโโโโโโโโโโ  โ
                    โโโโโโโโโฌโโโโโโโโโโโโ
                            โ API calls
              โโโโโโโโโโโโโโโผโโโโโโโโโโโโโโ
              โ             โ             โ
         โโโโโโผโโโโโ   โโโโโโผโโโโโ
         โ agent-01โ   โ agent-02โ
         โ .10.51  โ   โ .10.52  โ
         โ         โ   โ         โ
         โ โโโโโโโ โ   โ โโโโโโโ โ
         โ โkubelโ โ   โ โkubelโ โ โโโ ะขะพะปัะบะพ workload pods
         โ โproxyโ โ   โ โproxyโ โ
         โ โcontaโ โ   โ โcontaโ โ
         โ โโโโโโโ โ   โ โโโโโโโ โ
         โโโโโโโโโโโ   โโโโโโโโโโโ
```

**ะะปััะตะฒะพะต ะพัะปะธัะธะต:**
- **Server:** ะฃะฟัะฐะฒะปัะตั ะบะปะฐััะตัะพะผ + ะผะพะถะตั ะทะฐะฟััะบะฐัั workloads
- **Agent:** ะขะพะปัะบะพ ะทะฐะฟััะบะฐะตั workloads, ัะฟัะฐะฒะปะตะฝะธะต ะฟะพะปััะฐะตั ะพั Server

---

## ๐ ะัะพัะตัั ะฟัะธัะพะตะดะธะฝะตะฝะธั Agent ะบ ะบะปะฐััะตัั

### ะจะฐะณ 1: ะะพะดะณะพัะพะฒะบะฐ
```bash
# ะะฐ ะฝะพะฒะพะน ะฝะพะดะต ะดะพะปะถะฝั ะฑััั:
โ Ubuntu 24.04 ั ะฑะฐะทะพะฒัะผะธ ะฟะฐะบะตัะฐะผะธ
โ ะกะตัะตะฒะพะต ะฟะพะดะบะปััะตะฝะธะต ะบ Server (10.246.10.50:6443)
โ Node-token ะธะท Server ะฝะพะดั
โ ะกัะฐัะธัะตัะบะธะน IP ะฐะดัะตั
```

### ะจะฐะณ 2: ะะพะผะฐะฝะดะฐ ัััะฐะฝะพะฒะบะธ
```bash
curl -sfL https://get.k3s.io | \
  K3S_URL=https://10.246.10.50:6443 \
  K3S_TOKEN=<node-token> \
  sh -s - agent \
  --node-ip <IP_ะฝะพะดั> \
  --node-name <ะธะผั_ะฝะพะดั>
```

### ะจะฐะณ 3: ะงัะพ ะฟัะพะธััะพะดะธั ะฟัะธ ะฒัะฟะพะปะฝะตะฝะธะธ

```yaml
1. ะะฐะณััะทะบะฐ k3s binary:
   - ะกะบะฐัะธะฒะฐะตััั ะฟะพัะปะตะดะฝัั stable ะฒะตััะธั k3s
   - ะฃััะฐะฝะฐะฒะปะธะฒะฐะตััั ะฒ /usr/local/bin/k3s

2. ะัะพะฒะตัะบะฐ ะฟะพะดะบะปััะตะฝะธั ะบ Server:
   - ะัะพะฒะตััะตััั ะดะพัััะฟะฝะพััั https://10.246.10.50:6443
   - ะะฐะปะธะดะธััะตััั node-token

3. ะกะพะทะดะฐะฝะธะต systemd service:
   - ะกะพะทะดะฐะตััั /etc/systemd/system/k3s-agent.service
   - ะะบะปััะฐะตััั ะฐะฒัะพะทะฐะฟััะบ ะฟัะธ boot

4. ะะฐะฟััะบ Agent ะบะพะผะฟะพะฝะตะฝัะพะฒ:
   - kubelet ะฟะพะดะบะปััะฐะตััั ะบ API Server
   - kube-proxy ะฝะฐัััะฐะธะฒะฐะตั ัะตัั
   - containerd ะณะพัะพะฒ ะบ ะทะฐะฟััะบั ะบะพะฝัะตะนะฝะตัะพะฒ

5. ะะตะณะธัััะฐัะธั ะฝะพะดั ะฒ ะบะปะฐััะตัะต:
   - Server ะดะพะฑะฐะฒะปัะตั ะฝะพะดั ะฒ ัะฟะธัะพะบ
   - kubectl get nodes ะฟะพะบะฐะทัะฒะฐะตั ะฝะพะฒัั ะฝะพะดั
```

### ะจะฐะณ 4: ะะตะทัะปััะฐั
- Agent ะฝะพะดะฐ ะฟะพัะฒะปัะตััั ะฒ `kubectl get nodes`
- ะกัะฐััั ะผะตะฝัะตััั ั `NotReady` โ `Ready` (~30 ัะตะบ)
- Scheduler ะผะพะถะตั ัะฐะทะผะตัะฐัั pods ะฝะฐ ะฝะพะฒะพะน ะฝะพะดะต

---

## ๐ ะะพะปั node-token ะฒ ะฑะตะทะพะฟะฐัะฝะพััะธ

### ะงัะพ ัะฐะบะพะต node-token?

**Node-token** โ ััะพ ัะตะบัะตัะฝัะน ะบะปัั, ะบะพัะพััะน:
- ะะตะฝะตัะธััะตััั ะฐะฒัะพะผะฐัะธัะตัะบะธ ะฟัะธ ัััะฐะฝะพะฒะบะต k3s Server
- ะัะฟะพะปัะทัะตััั ะดะปั ะฐััะตะฝัะธัะธะบะฐัะธะธ Agent ะฝะพะด ะฟัะธ ะฟัะธัะพะตะดะธะฝะตะฝะธะธ
- ะะฐัะพะดะธััั ะฒ ัะฐะนะปะต `/var/lib/rancher/k3s/server/node-token` ะฝะฐ Server

### ะคะพัะผะฐั token:
```
K10abcd1234567890::server:1234567890abcdef1234567890abcdef
โ        โ          โ    โ
โ        โ          โ    โโโ Server secret (32 ัะธะผะฒะพะปะฐ)
โ        โ          โโโ ะขะธะฟ: server
โ        โโโ Random part
โโโ ะัะตัะธะบั k3s
```

### ะะตะทะพะฟะฐัะฝะพััั:
- โ **ะะดะฝะพััะพัะพะฝะฝัั ะฐััะตะฝัะธัะธะบะฐัะธั:** Token ะฟัะพะฒะตััะตััั ัะพะปัะบะพ Server
- โ **ะะฒัะพะผะฐัะธัะตัะบะฐั ัะพัะฐัะธั:** Token ะผะพะถะฝะพ ะธะทะผะตะฝะธัั ัะตัะตะท API
- โ๏ธ **ะะพะปะฝัะน ะดะพัััะฟ:** Token ะดะฐัั ะฟัะฐะฒะพ ะฟัะธัะพะตะดะธะฝะธัั ะปัะฑัั ะฝะพะดั
- ๐ **ะกะตะบัะตัะฝะพััั:** ะะ ะบะพะผะผะธัะธัั ะฒ git, ััะฐะฝะธัั ะฒ ะฑะตะทะพะฟะฐัะฝะพะผ ะผะตััะต

---

## ๐ ะกะตัะตะฒะพะต ะฒะทะฐะธะผะพะดะตะนััะฒะธะต Server โ Agent

### ะะฑัะทะฐัะตะปัะฝัะต ัะตัะตะฒัะต ัะพะตะดะธะฝะตะฝะธั:

#### Agent โ Server (ะธััะพะดััะธะต):
```yaml
Port 6443 (TCP):
  ะะฐะทะฝะฐัะตะฝะธะต: Kubernetes API Server
  ะัะพัะพะบะพะป: HTTPS (TLS)
  ะัะฟะพะปัะทะพะฒะฐะฝะธะต:
    - kubelet ัะตะณะธัััะฐัะธั ะธ heartbeat
    - ะะพะปััะตะฝะธะต ะบะพะผะฐะฝะด ะดะปั pods
    - ะัะฟัะฐะฒะบะฐ ััะฐัััะฐ ะฝะพะดั

Port 10250 (TCP):
  ะะฐะทะฝะฐัะตะฝะธะต: kubelet API (ะฝะฐ ะฒัะตั ะฝะพะดะฐั)
  ะัะพัะพะบะพะป: HTTPS
  ะัะฟะพะปัะทะพะฒะฐะฝะธะต:
    - Server ะผะพะถะตั ะฒัะฟะพะปะฝััั ะบะพะผะฐะฝะดั ะฝะฐ Agent
    - kubectl logs, kubectl exec
```

#### Flannel (ะผะตะถะดั ะฒัะตะผะธ ะฝะพะดะฐะผะธ):
```yaml
Port 8472 (UDP):
  ะะฐะทะฝะฐัะตะฝะธะต: Flannel VXLAN
  ะัะพัะพะบะพะป: UDP/VXLAN
  ะัะฟะพะปัะทะพะฒะฐะฝะธะต:
    - Inter-pod communication
    - Pod-to-pod networking ะผะตะถะดั ะฝะพะดะฐะผะธ
```

### ะกะตัะตะฒะฐั ััะตะผะฐ ะดะปั ะฝะฐัะตะน ะธะฝััะฐััััะบัััั:

```
Internet
    โ
    โผ
NSX-T T1 Gateway (10.246.10.1)
    โ
    โผ
k8s-zeon-dev-segment (10.246.10.0/24)
    โ
    โโโ Server: 10.246.10.50:6443  โโโ Agent ะฟะพะดะบะปััะฐัััั ััะดะฐ
    โโโ Agent1: 10.246.10.51:10250 โโโ Server ัะฟัะฐะฒะปัะตั
    โโโ Agent2: 10.246.10.52:10250 โโโ Server ัะฟัะฐะฒะปัะตั

Flannel overlay:
    โโโ Server: 10.42.0.x/24
    โโโ Agent1: 10.42.1.x/24  โโโ Pod subnets
    โโโ Agent2: 10.42.2.x/24
```

### ะัะพะฒะตัะบะฐ ัะตัะตะฒะพะน ัะฒัะทะฝะพััะธ:
```bash
# ะก Agent ะฝะพะดั ะฟัะพะฒะตัะธัั ะดะพัััะฟะฝะพััั Server
ping 10.246.10.50
curl -k https://10.246.10.50:6443/version

# ะัะพะฒะตัะธัั ััะพ ะฟะพััั ะพัะบัััั
telnet 10.246.10.50 6443
telnet 10.246.10.50 10250
```

---

## โก ะัะตะธะผััะตััะฒะฐ k3s Agent ะฐััะธัะตะบัััั

### 1. ะัะพััะพัะฐ ัะฐะทะฒััััะฒะฐะฝะธั
- **ะะดะฝะฐ ะบะพะผะฐะฝะดะฐ** ะดะปั ะฟัะธัะพะตะดะธะฝะตะฝะธั ะฝะพะดั
- **ะะฒัะพะผะฐัะธัะตัะบะฐั ะฒะตััะธั** (ัะพะฒะฟะฐะดะฐะตั ั Server)
- **ะัััะพะตะฝะฝัะต ะบะพะผะฟะพะฝะตะฝัั** (ะฝะต ะฝัะถะฝะพ ัััะฐะฝะฐะฒะปะธะฒะฐัั CNI, runtime)

### 2. ะะธะฝะธะผะฐะปัะฝัะต ัะตััััั
```yaml
Agent Node ััะตะฑัะตั:
  RAM: 512 ะะ ะผะธะฝะธะผัะผ (2 ะะ ัะตะบะพะผะตะฝะดัะตััั)
  CPU: 1 core ะผะธะฝะธะผัะผ (2 cores ัะตะบะพะผะตะฝะดัะตััั)
  Disk: 20 ะะ ะผะธะฝะธะผัะผ (40 ะะ ัะตะบะพะผะตะฝะดัะตััั)
  Network: 1 ะะฑะธั/ั
```

### 3. ะััะพะบะฐั ะดะพัััะฟะฝะพััั workload
- ะัะธ ะฟะฐะดะตะฝะธะธ ะพะดะฝะพะน Agent ะฝะพะดั, pods ะฟะตัะตะผะตัะฐัััั ะฝะฐ ะดััะณะธะต
- Server ะพััะฐัััั ะดะพัััะฟะตะฝ ะดะปั ัะฟัะฐะฒะปะตะฝะธั
- ะะพะฑะฐะฒะปะตะฝะธะต ะฝะพะฒัั Agent ะฝะพะด ะฑะตะท downtime

### 4. ะะพัะธะทะพะฝัะฐะปัะฝะพะต ะผะฐัััะฐะฑะธัะพะฒะฐะฝะธะต
```bash
# ะะพะฑะฐะฒะธัั ะฝะพะฒัั Agent ะฝะพะดั = 2 ะผะธะฝััั
1. ะะปะพะฝะธัะพะฒะฐัั VM
2. ะฃััะฐะฝะพะฒะธัั k3s agent
3. kubectl get nodes - ะฒะธะดะธะผ ะฝะพะฒัั ะฝะพะดั
```

---

## ๐ฏ ะะพัะพะฒะฝะพััั ะบ ัััะฐะฝะพะฒะบะต

ะะพัะปะต ะธะทััะตะฝะธั ััะพะณะพ ะพะฑะทะพัะฐ, ะดะปั ัััะฐะฝะพะฒะบะธ Agent ะฝะพะด ะฝัะถะฝะพ:

### ะัะตะดะฒะฐัะธัะตะปัะฝัะต ััะตะฑะพะฒะฐะฝะธั:
- โ **k3s Server ัะฐะฑะพัะฐะตั** ะฝะฐ 10.246.10.50
- โ **Node-token ะฟะพะปััะตะฝ** ะธะท `/var/lib/rancher/k3s/server/node-token`
- โ **2 VM ะณะพัะพะฒั** ั IP 10.246.10.51 ะธ 10.246.10.52
- โ **SSH ะดะพัััะฟ** ะบ Agent ะฝะพะดะฐะผ
- โ **ะกะตัะตะฒะฐั ัะฒัะทะฝะพััั** ะฟัะพะฒะตัะตะฝะฐ

### ะัะพัะตัั ัััะฐะฝะพะฒะบะธ:
1. **ะะพะปััะธัั node-token** ั Server ะฝะพะดั
2. **SSH ะบ Agent ะฝะพะดะต**
3. **ะัะฟะพะปะฝะธัั ะบะพะผะฐะฝะดั ัััะฐะฝะพะฒะบะธ** k3s agent
4. **ะะพะถะดะฐัััั Ready ััะฐัััะฐ**
5. **ะะพะฒัะพัะธัั ะดะปั ะฒัะพัะพะน ะฝะพะดั**

### ะัะพะฒะตัะบะฐ ะณะพัะพะฒะฝะพััะธ ะบะปะฐััะตัะฐ:
```bash
# ะะฐ Server ะฝะพะดะต
kubectl get nodes
# ะะพะปะถะฝั ะฒะธะดะตัั 3 ะฝะพะดั: 1 Server + 2 Agent

kubectl get pods -A
# ะัะต ัะธััะตะผะฝัะต pods ะฒ Running ัะพััะพัะฝะธะธ
```

---

## ๐ ะกะปะตะดัััะธะต ัะฐะณะธ

**ะขะตะฟะตัั ะฒั ะฟะพะฝะธะผะฐะตัะต ะฐััะธัะตะบัััั k3s Agent ะฝะพะด!**

**ะะฐะปะตะต:**
- ะญัะฐะฟ 2: ะะพะปััะตะฝะธะต node-token ั Server ะฝะพะดั
- ะญัะฐะฟ 3: ะะปะพะฝะธัะพะฒะฐะฝะธะต VM ะดะปั Agent ะฝะพะด
- ะญัะฐะฟ 4: ะะพัะฐะณะพะฒะฐั ัััะฐะฝะพะฒะบะฐ k3s agent
- ะญัะฐะฟ 5: ะะฐะปะธะดะฐัะธั ะบะปะฐััะตัะฐ

---

**k3s Agent = ะัะพััะพะต ะฟัะธัะพะตะดะธะฝะตะฝะธะต ัะฐะฑะพัะธั ะฝะพะด ะบ ะบะปะฐััะตัั! ๐**
