# Troubleshooting Guide Ð´Ð»Ñ k3s Template

> **Ð­Ñ‚Ð°Ð¿:** 0 - VM Template Preparation
> **Ð¡Ñ‚Ð°Ñ‚ÑƒÑ:** âœ… Ð“ÐžÐ¢ÐžÐ’Ðž
> **Ð”Ð°Ñ‚Ð°:** 2025-10-24
> **Ð¦ÐµÐ»ÑŒ:** Ð ÐµÑˆÐµÐ½Ð¸Ðµ Ñ‚Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Template

---

## ðŸŽ¯ ÐžÐ±Ð·Ð¾Ñ€

Ð­Ñ‚Ð¾Ñ‚ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚ ÑÐ¾Ð´ÐµÑ€Ð¶Ð¸Ñ‚ **Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ñ‚Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ñ… Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼** Ð¿Ñ€Ð¸ ÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ð¸ Ð¸ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ð¸ Template Ð´Ð»Ñ k3s ÐºÐ»Ð°ÑÑ‚ÐµÑ€Ð°.

### âš ï¸ Ð’Ð°Ð¶Ð½Ð¾ Ð´Ð»Ñ Ð¾Ð¿ÐµÑ€Ð°Ñ‚Ð¾Ñ€Ð°

- **Ð¦ÐµÐ»ÑŒ:** Ð‘Ñ‹ÑÑ‚Ñ€Ð¾ Ñ€ÐµÑˆÐ¸Ñ‚ÑŒ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ð±ÐµÐ· Ð¿ÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ñ Template
- **ÐŸÐ¾Ð´Ñ…Ð¾Ð´:** ÐžÑ‚ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ñ… Ðº ÑÐ»Ð¾Ð¶Ð½Ñ‹Ð¼ Ñ€ÐµÑˆÐµÐ½Ð¸ÑÐ¼
- **Ð’Ñ€ÐµÐ¼Ñ:** Ð—Ð°Ð²Ð¸ÑÐ¸Ñ‚ Ð¾Ñ‚ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ (5-30 Ð¼Ð¸Ð½ÑƒÑ‚)

---

## ðŸš¨ Ð¢Ð¸Ð¿Ð¸Ñ‡Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 1: Cloud-init Ð½Ðµ Ð¾Ñ‚Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- Ð¡Ñ‚Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸Ð¹ IP Ð½Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½ÑÐµÑ‚ÑÑ
- Hostname Ð½Ðµ ÑƒÑÑ‚Ð°Ð½Ð°Ð²Ð»Ð¸Ð²Ð°ÐµÑ‚ÑÑ
- SSH Ð½Ðµ Ð½Ð°ÑÑ‚Ñ€Ð°Ð¸Ð²Ð°ÐµÑ‚ÑÑ
- ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ñ‘Ñ‚ÑÑ

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° cloud-init
cloud-init status
# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ: done

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð² cloud-init
cat /var/log/cloud-init.log
# Ð˜Ñ‰Ð¸Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ð»Ð¾Ð³Ð°Ñ…

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²Ñ€ÐµÐ¼ÐµÐ½Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ
cloud-init status --long
# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð¿Ð¾ÐºÐ°Ð·Ð°Ñ‚ÑŒ Ð²Ñ€ÐµÐ¼Ñ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ñ

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
cat /etc/cloud/cloud.cfg
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° cloud-init Ð´Ð»Ñ VMware**

```bash
# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° cloud-init Ð´Ð»Ñ VMware vSphere
sudo tee /etc/cloud/cloud.cfg.d/98-datasource.cfg >/dev/null <<'YAML'
datasource_list: [ VMware, OVF, NoCloud, None ]
YAML

# Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ cloud-init ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
sudo systemctl unmask cloud-init cloud-init-local cloud-config cloud-final
sudo systemctl enable cloud-init cloud-init-local cloud-config cloud-final

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ ÐºÐ°ÑÑ‚Ð¾Ð¼Ð½Ñ‹Ñ… netplan-Ñ„Ð°Ð¹Ð»Ð¾Ð² Ð´Ð»Ñ Ð³ÐµÐ½ÐµÑ€Ð°Ñ†Ð¸Ð¸ 50-cloud-init.yaml
sudo rm -f /etc/netplan/*.yaml

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ cloud-init
sudo cloud-init clean --logs --machine
sudo rm -rf /var/lib/cloud

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº cloud-init
sudo cloud-init init

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
cloud-init status
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Ð² vSphere**

1. **ÐžÑ‚ÐºÑ€Ð¾Ð¹Ñ‚Ðµ vSphere Client**
2. **Ð’Ñ‹Ð±ÐµÑ€Ð¸Ñ‚Ðµ VM**
3. **ÐŸÑ€Ð°Ð²Ñ‹Ð¹ ÐºÐ»Ð¸Ðº** â†’ **Edit Settings**
4. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ cloud-init:**
   - **User Data:** Ð”Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ cloud-init ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸ÑŽ
   - **Meta Data:** Ð”Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð¼ÐµÑ‚Ð°Ð´Ð°Ð½Ð½Ñ‹Ðµ
   - **Network Data:** Ð”Ð¾Ð»Ð¶ÐµÐ½ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ ÑÐµÑ‚ÐµÐ²Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: Ð ÑƒÑ‡Ð½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÑ‚Ð¸**

```bash
# Ð•ÑÐ»Ð¸ cloud-init Ð½Ðµ Ð¿Ñ€Ð¸Ð¼ÐµÐ½Ð¸Ð» ÑÐµÑ‚ÐµÐ²Ñ‹Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
sudo netplan apply

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
sudo systemctl restart systemd-networkd

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
ip addr show ens192
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 4: Ð ÑƒÑ‡Ð½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ**

```bash
# Ð•ÑÐ»Ð¸ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð½Ðµ ÑÐ¾Ð·Ð´Ð°Ð»ÑÑ
sudo useradd -m -s /bin/bash k8s-admin
sudo usermod -aG sudo k8s-admin
echo 'k8s-admin:admin' | sudo chpasswd

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° SSH
sudo systemctl enable ssh
sudo systemctl start ssh
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 2: Ð¡ÐµÑ‚ÑŒ Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- IP Ð½Ðµ Ð½Ð°Ð·Ð½Ð°Ñ‡Ð°ÐµÑ‚ÑÑ
- ÐÐµÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ
- ÐÐ¾Ð´Ñ‹ Ð½Ðµ Ð²Ð¸Ð´ÑÑ‚ Ð´Ñ€ÑƒÐ³ Ð´Ñ€ÑƒÐ³Ð°
- DNS Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹ÑÐ¾Ð²
ip addr show
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð¸Ð½Ñ‚ÐµÑ€Ñ„ÐµÐ¹Ñ ens192

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¼Ð°Ñ€ÑˆÑ€ÑƒÑ‚Ð¾Ð²
ip route
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ default route

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° DNS
cat /etc/resolv.conf
# Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ DNS ÑÐµÑ€Ð²ÐµÑ€Ñ‹

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº gateway
ping -c 3 10.246.10.1
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ ping

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ Ðº Ð¸Ð½Ñ‚ÐµÑ€Ð½ÐµÑ‚Ñƒ
ping -c 3 8.8.8.8
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑƒÑÐ¿ÐµÑˆÐ½Ñ‹Ð¹ ping
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº**

```bash
# ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ netplan
sudo netplan apply

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
sudo systemctl restart systemd-networkd

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
sudo systemctl status systemd-networkd
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: Ð ÑƒÑ‡Ð½Ð°Ñ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÑ‚Ð¸**

```bash
# Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ñ„Ð°Ð¹Ð»Ð° netplan
sudo tee /etc/netplan/01-static-ip.yaml > /dev/null << 'EOF'
network:
  version: 2
  ethernets:
    ens192:
      addresses:
        - 10.246.10.50/24
      routes:
        - to: default
          via: 10.246.10.1
      nameservers:
        addresses:
          - 172.17.10.3
          - 8.8.8.8
      dhcp4: false
      dhcp6: false
EOF

# ÐŸÑ€Ð¸Ð¼ÐµÐ½ÐµÐ½Ð¸Ðµ Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
sudo netplan apply
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° NSX-T segment**

1. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð² vSphere UI:**
   - VM Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð° Ðº Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾Ð¼Ñƒ segment
   - Segment Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ð¾
   - Gateway Ð´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð² NSX-T UI:**
   - T1 Gateway Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½
   - Route Advertisement Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½
   - NAT Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÑŽÑ‚

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 4: Ð¡Ð±Ñ€Ð¾Ñ ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº**

```bash
# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
sudo systemctl stop systemd-networkd

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº
sudo rm -f /etc/netplan/*.yaml

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº ÑÐµÑ‚ÐµÐ²Ñ‹Ñ… ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
sudo systemctl start systemd-networkd

# ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° ÑÐµÑ‚Ð¸ Ð·Ð°Ð½Ð¾Ð²Ð¾
sudo netplan apply
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 3: SSH Ð½ÐµÐ´Ð¾ÑÑ‚ÑƒÐ¿ÐµÐ½

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- ÐÐµ ÑƒÐ´Ð°Ñ‘Ñ‚ÑÑ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡Ð¸Ñ‚ÑŒÑÑ Ð¿Ð¾ SSH
- Ð¢Ð°Ð¹Ð¼Ð°ÑƒÑ‚ Ð¿Ð¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ñ
- ÐžÑ‚ÐºÐ°Ð· Ð² Ð´Ð¾ÑÑ‚ÑƒÐ¿Ðµ
- ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð½Ðµ Ð¿Ñ€Ð¸Ð½Ð¸Ð¼Ð°ÐµÑ‚ÑÑ

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° SSH
sudo systemctl status ssh
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ: active (running)

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ñ€Ñ‚Ð¾Ð²
sudo netstat -tlnp | grep :22
# Ð”Ð¾Ð»Ð¶ÐµÐ½ ÑÐ»ÑƒÑˆÐ°Ñ‚ÑŒ Ð½Ð° Ð¿Ð¾Ñ€Ñ‚Ñƒ 22

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° firewall
sudo ufw status
# Ð”Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ Ð¿Ñ€Ð°Ð²Ð¸Ð»Ð° Ð´Ð»Ñ SSH

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ
id k8s-admin
# ÐŸÐ¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ ÑÑƒÑ‰ÐµÑÑ‚Ð²Ð¾Ð²Ð°Ñ‚ÑŒ

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð°Ñ€Ð¾Ð»Ñ
sudo passwd -S k8s-admin
# ÐŸÐ°Ñ€Ð¾Ð»ÑŒ Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: Ð—Ð°Ð¿ÑƒÑÐº SSH**

```bash
# Ð’ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ SSH
sudo systemctl enable ssh
sudo systemctl start ssh

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ°
sudo systemctl status ssh
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ° firewall**

```bash
# Ð Ð°Ð·Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ SSH Ñ‡ÐµÑ€ÐµÐ· firewall
sudo ufw allow ssh

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ñ€Ð°Ð²Ð¸Ð»
sudo ufw status
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: Ð¡Ð±Ñ€Ð¾Ñ Ð¿Ð°Ñ€Ð¾Ð»Ñ**

```bash
# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð¿Ð°Ñ€Ð¾Ð»Ñ
echo 'k8s-admin:admin' | sudo chpasswd

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð°Ñ€Ð¾Ð»Ñ
sudo passwd -S k8s-admin
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 4: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° SSH ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸**

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° SSH ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo cat /etc/ssh/sshd_config | grep -E "(PasswordAuthentication|PermitRootLogin|Port)"

# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ:
# PasswordAuthentication yes
# PermitRootLogin no
# Port 22

# ÐŸÐµÑ€ÐµÐ·Ð°Ð¿ÑƒÑÐº SSH
sudo systemctl restart ssh
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 5: Cloud-init ÑƒÐ¿Ñ€Ð°Ð²Ð»ÐµÐ½Ð¸Ðµ SSH**

```bash
# Cloud-init Ð°Ð²Ñ‚Ð¾Ð¼Ð°Ñ‚Ð¸Ñ‡ÐµÑÐºÐ¸ ÑƒÐ¿Ñ€Ð°Ð²Ð»ÑÐµÑ‚ SSH Ð¿Ñ€Ð¸ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ñ‡Ñ‚Ð¾ cloud-init Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐ½ Ð¿Ñ€Ð°Ð²Ð¸Ð»ÑŒÐ½Ð¾
cat /etc/cloud/cloud.cfg.d/98-datasource.cfg

# Ð”Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ:
# datasource_list: [ VMware, OVF, NoCloud, None ]

# ÐŸÑ€Ð¸ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸ cloud-init:
# 1. Ð£Ð´Ð°Ð»Ð¸Ñ‚ ÑÑ‚Ð°Ñ€Ñ‹Ðµ SSH ÐºÐ»ÑŽÑ‡Ð¸ Ñ…Ð¾ÑÑ‚Ð°
# 2. Ð¡Ð³ÐµÐ½ÐµÑ€Ð¸Ñ€ÑƒÐµÑ‚ Ð½Ð¾Ð²Ñ‹Ðµ SSH ÐºÐ»ÑŽÑ‡Ð¸
# 3. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»Ñ k8s-admin
# 4. ÐÐ°ÑÑ‚Ñ€Ð¾Ð¸Ñ‚ Ð¿Ð°Ñ€Ð¾Ð»ÑŒ admin
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 4: VMware Tools Ð½Ðµ Ñ€Ð°Ð±Ð¾Ñ‚Ð°ÐµÑ‚

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- VMware Tools Ð½Ðµ Ð°ÐºÑ‚Ð¸Ð²ÐµÐ½
- ÐÐµÑ‚ Ð¸Ð½Ñ‚ÐµÐ³Ñ€Ð°Ñ†Ð¸Ð¸ Ñ vSphere
- ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼
- ÐžÑˆÐ¸Ð±ÐºÐ¸ Ð² Ð»Ð¾Ð³Ð°Ñ…

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÑ‚Ð°Ñ‚ÑƒÑÐ° VMware Tools
sudo systemctl status open-vm-tools
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ: active (running)

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð²ÐµÑ€ÑÐ¸Ð¸
vmware-toolbox-cmd --version
# Ð”Ð¾Ð»Ð¶Ð½Ð° Ð±Ñ‹Ñ‚ÑŒ Ð²ÐµÑ€ÑÐ¸Ñ

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
sudo journalctl -u open-vm-tools
# Ð˜Ñ‰Ð¸Ñ‚Ðµ Ð¾ÑˆÐ¸Ð±ÐºÐ¸ Ð² Ð»Ð¾Ð³Ð°Ñ…

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ¸
dpkg -l | grep open-vm-tools
# ÐŸÐ°ÐºÐµÑ‚Ñ‹ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: ÐŸÐµÑ€ÐµÑƒÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° VMware Tools**

```bash
# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ ÑÑ‚Ð°Ñ€Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
sudo apt remove --purge open-vm-tools open-vm-tools-desktop

# Ð£ÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° Ð½Ð¾Ð²Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
sudo apt update
sudo apt install -y open-vm-tools open-vm-tools-desktop

# Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ°
sudo systemctl enable open-vm-tools
sudo systemctl start open-vm-tools
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸**

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¸
sudo cat /etc/vmware-tools/tools.conf

# Ð”Ð¾Ð»Ð¶Ð½Ð¾ ÑÐ¾Ð´ÐµÑ€Ð¶Ð°Ñ‚ÑŒ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð»Ñ VMware
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº**

```bash
# ÐžÑÑ‚Ð°Ð½Ð¾Ð²ÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ°
sudo systemctl stop open-vm-tools

# Ð ÑƒÑ‡Ð½Ð¾Ð¹ Ð·Ð°Ð¿ÑƒÑÐº
sudo /usr/bin/vmware-toolbox-cmd

# Ð—Ð°Ð¿ÑƒÑÐº ÑÐµÑ€Ð²Ð¸ÑÐ°
sudo systemctl start open-vm-tools
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 5: Template Ð½Ðµ ÐºÐ»Ð¾Ð½Ð¸Ñ€ÑƒÐµÑ‚ÑÑ

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- ÐžÑˆÐ¸Ð±ÐºÐ° Ð¿Ñ€Ð¸ ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð¸Ð¸
- VM Ð½Ðµ Ð·Ð°Ð¿ÑƒÑÐºÐ°ÐµÑ‚ÑÑ
- Cloud-init Ð½Ðµ Ð¾Ñ‚Ñ€Ð°Ð±Ð°Ñ‚Ñ‹Ð²Ð°ÐµÑ‚ Ð² ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ VM
- ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ñ‹ Ñ ÑÐµÑ‚ÑŒÑŽ

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¾ÑÑ‚Ð¾ÑÐ½Ð¸Ñ Template
# Ð’ vSphere UI: Template Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Templates

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº Template
# ÐŸÑ€Ð°Ð²Ñ‹Ð¹ ÐºÐ»Ð¸Ðº â†’ Edit Settings
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ð²ÑÐµ Ð½Ð°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Template**

1. **Ð’ vSphere UI:**
   - Template Ð´Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ Ð² Ñ€Ð°Ð·Ð´ÐµÐ»Ðµ Templates
   - ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹ÐºÐ¸ Ð´Ð¾Ð»Ð¶Ð½Ñ‹ Ð±Ñ‹Ñ‚ÑŒ ÐºÐ¾Ñ€Ñ€ÐµÐºÑ‚Ð½Ñ‹Ð¼Ð¸
   - ÐÐµÑ‚ Ð¾ÑˆÐ¸Ð±Ð¾Ðº Ð² ÑÑ‚Ð°Ñ‚ÑƒÑÐµ

2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð½Ð°ÑÑ‚Ñ€Ð¾ÐµÐº:**
   - vCPU: 2
   - RAM: 4 GB
   - Disk: 40 GB
   - Network: k8s-zeon-dev-segment

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¸Ðµ Ð½Ð¾Ð²Ð¾Ð¹ customization spec**

1. **Ð’ vSphere UI:**
   - **Home** â†’ **Policies and Profiles** â†’ **VM Customization**
   - **Create** â†’ **New Customization Spec**
   - **Name:** `k3s-customization`
   - **Guest OS:** Linux
   - **ÐÐ°ÑÑ‚Ñ€Ð¾Ð¹Ñ‚Ðµ cloud-init**

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 3: ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° cloud-init Ð² ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ VM**

```bash
# ÐŸÐ¾Ð´ÐºÐ»ÑŽÑ‡ÐµÐ½Ð¸Ðµ Ðº ÐºÐ»Ð¾Ð½Ð¸Ñ€Ð¾Ð²Ð°Ð½Ð½Ð¾Ð¹ VM
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° cloud-init
cloud-init status

# Ð•ÑÐ»Ð¸ cloud-init Ð½Ðµ Ð¾Ñ‚Ñ€Ð°Ð±Ð¾Ñ‚Ð°Ð»:
sudo cloud-init clean --logs
sudo cloud-init init
```

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 6: Ð—Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- Ð’ Template ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ kubeadm, kubelet, kubectl
- Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½ containerd Ð¸Ð»Ð¸ Docker
- Ð£ÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ñ‹ CNI Ð¿Ð»Ð°Ð³Ð¸Ð½Ñ‹
- Template Ð½Ðµ Ð¿Ð¾Ð´Ñ…Ð¾Ð´Ð¸Ñ‚ Ð´Ð»Ñ k3s

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑƒÑÑ‚Ð°Ð½Ð¾Ð²Ð»ÐµÐ½Ð½Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
dpkg -l | grep -E "(kubeadm|kubelet|kubectl|containerd|docker|flannel|calico|cilium)"

# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ð¾
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ð·Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½Ñ‹Ñ… Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²**

```bash
# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ K8s ÐºÐ¾Ð¼Ð¿Ð¾Ð½ÐµÐ½Ñ‚Ð¾Ð²
sudo apt remove --purge kubeadm kubelet kubectl kubernetes-cni

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ container runtime
sudo apt remove --purge containerd docker.io docker-ce cri-o

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ CNI Ð¿Ð»Ð°Ð³Ð¸Ð½Ð¾Ð²
sudo apt remove --purge flannel calico cilium

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ Ingress ÐºÐ¾Ð½Ñ‚Ñ€Ð¾Ð»Ð»ÐµÑ€Ð¾Ð²
sudo apt remove --purge nginx-ingress traefik

# Ð£Ð´Ð°Ð»ÐµÐ½Ð¸Ðµ LoadBalancer
sudo apt remove --purge metallb kube-vip

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
sudo apt autoremove -y
sudo apt autoclean
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: ÐŸÐµÑ€ÐµÑÐ¾Ð·Ð´Ð°Ð½Ð¸Ðµ Template**

Ð•ÑÐ»Ð¸ Ð·Ð°Ð¿Ñ€ÐµÑ‰Ñ‘Ð½Ð½Ñ‹Ðµ Ð¿Ð°ÐºÐµÑ‚Ñ‹ Ð½Ðµ ÑƒÐ´Ð°Ð»ÑÑŽÑ‚ÑÑ:

1. **Ð£Ð´Ð°Ð»Ð¸Ñ‚Ðµ Ñ‚ÐµÐºÑƒÑ‰Ð¸Ð¹ Template**
2. **Ð¡Ð¾Ð·Ð´Ð°Ð¹Ñ‚Ðµ Ð½Ð¾Ð²ÑƒÑŽ VM** Ð¿Ð¾ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸Ð¸
3. **Ð’Ñ‹Ð¿Ð¾Ð»Ð½Ð¸Ñ‚Ðµ ÑÐºÑ€Ð¸Ð¿Ñ‚** `prepare-vm-template.sh`
4. **ÐšÐ¾Ð½Ð²ÐµÑ€Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð² Template**

---

### ÐŸÑ€Ð¾Ð±Ð»ÐµÐ¼Ð° 7: Ð¡Ð¸ÑÑ‚ÐµÐ¼Ð° Ð½Ðµ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ð°

#### Ð¡Ð¸Ð¼Ð¿Ñ‚Ð¾Ð¼Ñ‹

- Ð›Ð¾Ð³Ð¸ Ð½Ðµ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½Ñ‹
- History ÐºÐ¾Ð¼Ð°Ð½Ð´ Ð½Ðµ Ð¾Ñ‡Ð¸Ñ‰ÐµÐ½
- SSH keys Ð½Ðµ ÑƒÐ´Ð°Ð»ÐµÐ½Ñ‹
- Machine-id Ð½Ðµ ÑÐ±Ñ€Ð¾ÑˆÐµÐ½

#### Ð”Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ°

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
sudo journalctl --disk-usage
# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð¸Ð½Ð¸Ð¼Ð°Ð»ÑŒÐ½Ð¾Ðµ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸Ðµ

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° history
history | wc -l
# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¼Ð°Ð»Ð¾ ÐºÐ¾Ð¼Ð°Ð½Ð´

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° SSH keys
ls -la /etc/ssh/ssh_host_*
# Ð”Ð¾Ð»Ð¶Ð½Ð¾ Ð±Ñ‹Ñ‚ÑŒ Ð¿ÑƒÑÑ‚Ð¾

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° machine-id
cat /etc/machine-id
# Ð”Ð¾Ð»Ð¶ÐµÐ½ Ð±Ñ‹Ñ‚ÑŒ ÑƒÐ½Ð¸ÐºÐ°Ð»ÑŒÐ½Ñ‹Ð¹
```

#### Ð ÐµÑˆÐµÐ½Ð¸Ñ

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 1: Ð ÑƒÑ‡Ð½Ð°Ñ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ°**

```bash
# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
sudo journalctl --vacuum-time=1d
sudo find /var/log -type f -name "*.log" -exec truncate -s 0 {} \;

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° history
history -c
rm -f ~/.bash_history

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° SSH keys
sudo rm -f /etc/ssh/ssh_host_*

# Ð¡Ð±Ñ€Ð¾Ñ machine-id
sudo truncate -s 0 /etc/machine-id
sudo rm -f /var/lib/dbus/machine-id
sudo systemd-machine-id-setup

# ÐžÑ‡Ð¸ÑÑ‚ÐºÐ° cloud-init
sudo cloud-init clean --logs
```

**Ð ÐµÑˆÐµÐ½Ð¸Ðµ 2: ÐŸÐ¾Ð²Ñ‚Ð¾Ñ€Ð½Ñ‹Ð¹ Ð·Ð°Ð¿ÑƒÑÐº ÑÐºÑ€Ð¸Ð¿Ñ‚Ð°**

```bash
# Ð—Ð°Ð¿ÑƒÑÐº ÑÐºÑ€Ð¸Ð¿Ñ‚Ð° Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸
sudo /opt/k3s-setup/prepare-vm-template.sh

# Ð˜Ð»Ð¸ Ð²Ñ‹Ð¿Ð¾Ð»Ð½ÐµÐ½Ð¸Ðµ Ñ‚Ð¾Ð»ÑŒÐºÐ¾ Ð¾Ñ‡Ð¸ÑÑ‚ÐºÐ¸
sudo /opt/k3s-setup/prepare-vm-template.sh --cleanup-only
```

---

## ðŸ”§ ÐšÐ¾Ð¼Ð°Ð½Ð´Ñ‹ Ð´Ð¸Ð°Ð³Ð½Ð¾ÑÑ‚Ð¸ÐºÐ¸

### ÐžÐ±Ñ‰Ð¸Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐ¸ÑÑ‚ÐµÐ¼Ñ‹
uname -a
cat /etc/os-release
free -h
df -h

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ‚Ð¸
ip addr show
ip route
cat /etc/resolv.conf
ping -c 3 8.8.8.8

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° ÑÐµÑ€Ð²Ð¸ÑÐ¾Ð²
sudo systemctl status ssh
sudo systemctl status open-vm-tools
sudo systemctl status systemd-networkd

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° cloud-init
cloud-init status
cat /var/log/cloud-init.log
```

### Ð¡Ð¿ÐµÑ†Ð¸Ñ„Ð¸Ñ‡Ð½Ñ‹Ðµ ÐºÐ¾Ð¼Ð°Ð½Ð´Ñ‹

```bash
# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð°ÐºÐµÑ‚Ð¾Ð²
dpkg -l | grep -E "(curl|wget|vim|cloud-init|open-vm-tools)"
dpkg -l | grep -E "(kubeadm|kubelet|kubectl|containerd|docker)"

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° firewall
sudo ufw status
sudo netstat -tlnp

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ñ‚ÐµÐ»ÐµÐ¹
id k8s-admin
sudo passwd -S k8s-admin

# ÐŸÑ€Ð¾Ð²ÐµÑ€ÐºÐ° Ð»Ð¾Ð³Ð¾Ð²
sudo journalctl -xe
sudo journalctl -u ssh
sudo journalctl -u open-vm-tools
```

---

## ðŸ“‹ Ð§ÐµÐº-Ð»Ð¸ÑÑ‚ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### ÐŸÐµÑ€ÐµÐ´ Ð½Ð°Ñ‡Ð°Ð»Ð¾Ð¼

- [ ] ÐžÐ¿Ñ€ÐµÐ´ÐµÐ»Ð¸Ñ‚Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ñƒ
- [ ] Ð¡Ð¾Ð±ÐµÑ€Ð¸Ñ‚Ðµ Ð¸Ð½Ñ„Ð¾Ñ€Ð¼Ð°Ñ†Ð¸ÑŽ (Ð»Ð¾Ð³Ð¸, ÑÑ‚Ð°Ñ‚ÑƒÑÑ‹)
- [ ] ÐŸÐ¾Ð¿Ñ€Ð¾Ð±ÑƒÐ¹Ñ‚Ðµ Ð¿Ñ€Ð¾ÑÑ‚Ñ‹Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ
- [ ] Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð´ÐµÐ¹ÑÑ‚Ð²Ð¸Ñ

### ÐŸÐ¾ÑÐ»Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ñ

- [ ] ÐŸÑ€Ð¾Ð²ÐµÑ€ÑŒÑ‚Ðµ Ñ‡Ñ‚Ð¾ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼Ð° Ñ€ÐµÑˆÐµÐ½Ð°
- [ ] ÐŸÑ€Ð¾Ñ‚ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ñ„ÑƒÐ½ÐºÑ†Ð¸Ð¾Ð½Ð°Ð»ÑŒÐ½Ð¾ÑÑ‚ÑŒ
- [ ] ÐžÐ±Ð½Ð¾Ð²Ð¸Ñ‚Ðµ Ð´Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð°Ñ†Ð¸ÑŽ
- [ ] Ð¡Ð¾Ð¾Ð±Ñ‰Ð¸Ñ‚Ðµ Ð¾ Ñ€ÐµÐ·ÑƒÐ»ÑŒÑ‚Ð°Ñ‚Ð°Ñ…

---

## ðŸŽ¯ ÐŸÑ€Ð¾Ñ„Ð¸Ð»Ð°ÐºÑ‚Ð¸ÐºÐ° Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼

### Ð ÐµÐºÐ¾Ð¼ÐµÐ½Ð´Ð°Ñ†Ð¸Ð¸

1. **Ð¡Ð»ÐµÐ´ÑƒÐ¹Ñ‚Ðµ Ð¸Ð½ÑÑ‚Ñ€ÑƒÐºÑ†Ð¸ÑÐ¼** Ñ‚Ð¾Ñ‡Ð½Ð¾
2. **ÐŸÑ€Ð¾Ð²ÐµÑ€ÑÐ¹Ñ‚Ðµ ÐºÐ°Ð¶Ð´Ñ‹Ð¹ ÑˆÐ°Ð³** Ð¿ÐµÑ€ÐµÐ´ Ð¿ÐµÑ€ÐµÑ…Ð¾Ð´Ð¾Ð¼ Ðº ÑÐ»ÐµÐ´ÑƒÑŽÑ‰ÐµÐ¼Ñƒ
3. **Ð”Ð¾ÐºÑƒÐ¼ÐµÐ½Ñ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Ð¸Ð·Ð¼ÐµÐ½ÐµÐ½Ð¸Ñ** Ð² ÑÐ¸ÑÑ‚ÐµÐ¼Ðµ
4. **Ð¢ÐµÑÑ‚Ð¸Ñ€ÑƒÐ¹Ñ‚Ðµ Template** Ð¿ÐµÑ€ÐµÐ´ Ð¸ÑÐ¿Ð¾Ð»ÑŒÐ·Ð¾Ð²Ð°Ð½Ð¸ÐµÐ¼
5. **Ð¡Ð¾Ð·Ð´Ð°Ð²Ð°Ð¹Ñ‚Ðµ Ñ€ÐµÐ·ÐµÑ€Ð²Ð½Ñ‹Ðµ ÐºÐ¾Ð¿Ð¸Ð¸** Ð²Ð°Ð¶Ð½Ñ‹Ñ… ÐºÐ¾Ð½Ñ„Ð¸Ð³ÑƒÑ€Ð°Ñ†Ð¸Ð¹

### ÐœÐ¾Ð½Ð¸Ñ‚Ð¾Ñ€Ð¸Ð½Ð³

```bash
# Ð ÐµÐ³ÑƒÐ»ÑÑ€Ð½Ñ‹Ðµ Ð¿Ñ€Ð¾Ð²ÐµÑ€ÐºÐ¸
sudo systemctl status ssh
sudo systemctl status open-vm-tools
cloud-init status
sudo ufw status
```

---

**Ð¡Ð¾Ð·Ð´Ð°Ð½Ð¾:** 2025-10-24
**AI-Ð°Ð³ÐµÐ½Ñ‚:** VM Template Specialist
**Ð¦ÐµÐ»ÑŒ:** Ð‘Ñ‹ÑÑ‚Ñ€Ð¾Ðµ Ñ€ÐµÑˆÐµÐ½Ð¸Ðµ Ð¿Ñ€Ð¾Ð±Ð»ÐµÐ¼ Ñ Template
